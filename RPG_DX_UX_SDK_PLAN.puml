@startuml
' SDK удалён, диаграмма отражает core-only интеграцию через use cases и порты
skinparam componentStyle rectangle
skinparam shadowing false
skinparam defaultTextAlignment left

package "py_accountant core" {
  component "application.use_cases.ledger" as LedgerUC
  component "application.use_cases_async" as AppUCAsync
  component "application.dto.models" as AppDTO
  component "application.ports" as Ports
}

component "infrastructure.persistence.sqlalchemy.uow" as InfraUow
component "infrastructure.persistence.sqlalchemy.repositories_async" as InfraRepo
component "external app (tgbank, bot, etc.)" as ExternalApp

ExternalApp --> LedgerUC
ExternalApp --> AppUCAsync

LedgerUC --> Ports
AppUCAsync --> Ports

InfraUow --> Ports
InfraRepo --> Ports
InfraRepo --> InfraUow

note right of LedgerUC
- PostTransaction(lines, memo, meta) -> TransactionDTO
- GetBalance(account_full_name, as_of, recompute)
- GetLedger/ListLedger(...)
- GetTradingBalanceRawDTOs/ DetailedDTOs(...)
end note

note right of Ports
- UnitOfWork / AsyncUnitOfWork
- Repository Protocols (accounts, currencies, transactions, fx_audit, aggregates)
end note

legend right
  |= Artifact |= Purpose |
  | application.use_cases.* | Public core API (use cases) |
  | application.ports | Contracts for UoW/Repositories |
  | infrastructure.* | Reference adapters (SQLAlchemy, logging, settings) |
endlegend

@enduml
